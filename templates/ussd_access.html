{% extends 'base.html' %}
{% load static %}

{% block title %}USSD Offline Access | GasGo{% endblock %}
{% block page_title %}Offline Ordering{% endblock %}

{% block landing_content %}
<div class="max-w-md mx-auto py-8 space-y-8 animate-fade-in">

    <div class="text-center space-y-4">
        <div class="w-16 h-16 bg-wells-navy rounded-3xl shadow-lg flex items-center justify-center mx-auto mb-6 transform -rotate-3">
            <img src="{% static 'images/logo.png' %}" alt="GasGo" class="h-10 w-auto brightness-0 invert">
        </div>
        <h1 class="text-4xl font-black text-wells-navy tracking-tighter">No <span class="text-wells-green">Data?</span></h1>
        <p class="text-slate-500 font-medium px-4">Order GasGo deliveries even without an internet connection using our dedicated USSD channel.</p>
    </div>

    <div class="bg-white rounded-[3rem] p-8 border border-slate-100 shadow-xl text-center space-y-6">
        <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Quick Dial</h3>

        <a href="https://simulator.africastalking.com:9246/" target="_blank" class="w-full bg-wells-navy text-white py-6 rounded-2xl font-black text-2xl hover:bg-wells-green transition-all flex items-center justify-center group shadow-lg">
            <i class="fas fa-phone-arrow-up-right mr-4 group-hover:scale-110 transition-transform"></i>
            *384*93233#
        </a>

        <p class="text-xs font-bold text-slate-400 italic">One-tap to launch the Africa's Talking simulator.</p>
    </div>

    <div class="bg-slate-100/50 rounded-[3rem] p-8 border-2 border-dashed border-slate-200 text-center">
        <h4 class="text-sm font-black text-wells-navy mb-2">New to USSD?</h4>
        <p class="text-xs text-slate-500 mb-6">Test the offline ordering flow using our interactive simulator.</p>

        <button onclick="openUSSD()" class="px-8 py-3 bg-white text-wells-navy border border-slate-200 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-wells-navy hover:text-white transition-all shadow-sm">
            Launch Simulator
        </button>
    </div>
</div>

<div id="ussdModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-wells-navy/80 backdrop-blur-sm hidden px-6">
    <div class="bg-[#f2f2f2] w-full max-w-[320px] rounded-[2rem] shadow-2xl border-[6px] border-[#333] overflow-hidden">
        <div class="p-6 space-y-4">
            <div id="ussdContent" class="bg-white p-4 rounded-xl border border-slate-200 min-h-[120px] text-sm font-mono text-slate-700 leading-relaxed">
                </div>

            <input type="text" id="ussdInput" class="w-full bg-white border border-slate-300 rounded-lg p-3 text-center font-bold focus:ring-2 focus:ring-wells-blue outline-none" placeholder="Enter option...">

            <div class="flex gap-2">
                <button onclick="closeUSSD()" class="flex-1 py-3 text-slate-500 font-bold text-sm hover:bg-slate-200 rounded-lg transition">Cancel</button>
                <button onclick="handleUSSDRouting()" class="flex-1 py-3 text-wells-blue font-black text-sm hover:bg-wells-blue/10 rounded-lg transition">Send</button>
            </div>
        </div>
    </div>
</div>

<style>
    @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fade-in 0.6s ease-out forwards; }
</style>
{% endblock %}

{% block scripts %}
<script>
    let currentStep = 0;

    const ussdSteps = [
        "Welcome to GasGo.\n1. Order Gas\n2. Track Order\n3. My Profile",
        "Select Brand:\n1. TotalEnergies\n2. Rubis\n3. Shell/Vivo",
        "Select Size:\n1. 6kg\n2. 13kg\n3. 22kg",
        "Order Confirmed! A rider will call you shortly to verify your location. Thank you!"
    ];

    function openUSSD() {
        currentStep = 0;
        document.getElementById('ussdModal').classList.remove('hidden');
        document.getElementById('ussdContent').innerText = ussdSteps[0];
        document.getElementById('ussdInput').value = "";
        document.getElementById('ussdInput').style.display = 'block'; // Ensure input shows up if re-opened
        document.getElementById('ussdInput').focus();
    }

    function closeUSSD() {
        document.getElementById('ussdModal').classList.add('hidden');
    }

    function handleUSSDRouting() {
        const input = document.getElementById('ussdInput').value;
        if (!input && currentStep < 3) return;

        currentStep++;
        if (currentStep < ussdSteps.length) {
            document.getElementById('ussdContent').innerText = ussdSteps[currentStep];
            document.getElementById('ussdInput').value = "";

            if (currentStep === 3) {
                document.getElementById('ussdInput').style.display = 'none';
            }
        } else {
            closeUSSD();
            document.getElementById('ussdInput').style.display = 'block';
        }
    }
</script>
{% endblock %}