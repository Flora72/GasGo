{% extends 'base.html' %}
{% load static %}

{% block title %}Emergency | GasGo{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/responsive.css' %}">
<link rel="stylesheet" href="{% static 'css/emer.css' %}">
<link rel="icon" href="{% static 'images/logo.png' %}" type="image/png">
<link rel="shortcut icon" href="{% static 'images/logo.png' %}" type="image/png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}
<main>
    <section>
        <h1>Emergency help</h1>
        <p>If you suspect a gas leak, see flames, or smell gas strongly, follow these steps immediately:</p>
        <ol>
            <li>Turn off the cylinder valve if it is safe to do so.</li>
            <li>Do NOT switch electrical appliances on/off. Avoid sparks/open flames.</li>
            <li>Open windows and doors for ventilation; evacuate the room.</li>
            <li>Call the fire brigade: <strong>999</strong> or <strong>112</strong> (Kenya).</li>
            <li>Contact GasGo emergency line: <a href="tel:+254800720000">0800 720 000 (toll‚Äëfree)</a>.</li>
        </ol>
        <p style="font-size:13px; color:#444;">Only return indoors after authorities confirm it is safe.</p>
    </section>

    <section class="emergency-contact">
        <h2>Quick contact options</h2>
        <ul>
            <li><strong>Call toll‚Äëfree (24/7):</strong> <a href="tel:+254800720000">0800 720 000</a></li>
            <li><strong>USSD support:</strong> Dial <code>*384*123#</code> on your phone for quick emergency prompts.</li>
            <li><strong>Email support:</strong> <a href="mailto:gasgosupport@gmail.com">gasgosupport@gmail.com</a></li>
            <li><strong>Chat with our AI assistant (24/7):</strong></li>
        </ul>

        <div id="chatbox" class="emergency-chatbox" aria-label="AI emergency assistant">
            <div id="chatlog" class="chat-log">
                <div class="bot-msg">
                    GasGo Assistant: Hello! I can help with LPG emergencies and troubleshooting. Type your issue (e.g., ‚ÄúI smell gas‚Äù, ‚Äúburner not lighting‚Äù, ‚Äúinstallation failed‚Äù).
                </div>
            </div>
          <div class="chat-input" style="display: flex; align-items: center; gap: 0.5rem;">
          <label for="chatinput" style="white-space: nowrap; font-weight: 500;">Your message:</label>
           <input id="chatinput" type="text" placeholder="Describe the issue‚Ä¶" style="flex: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;" />
            <button id="chatsend" type="button" style="padding: 0.5rem 1rem; background-color: #f97316; color: white; border: none; border-radius: 4px;">Send</button>
        </div>

            <p class="chat-note">Note: This is a demo helper. In life‚Äëthreatening situations, call 999/112 and our toll‚Äëfree line above.</p>
        </div>
    </section>

    <section>
        <h2>Report an installation or safety issue</h2>
        <form method="post" action="">
            {% csrf_token %}
            <fieldset>
                <legend>Your details</legend>
                <p><label for="id_name">Full name</label><br><input id="id_name" name="name" type="text" placeholder="Amina Ali" required></p>
                <p><label for="id_phone">Phone</label><br><input id="id_phone" name="phone" type="tel" placeholder="0712 345 678" required></p>
                <p><label for="id_address">Location/Address</label><br><input id="id_address" name="address" type="text" placeholder="Estate, Area, City" required></p>
            </fieldset>
            <fieldset>
                <legend>Issue details</legend>
                <p><label for="id_issue">What went wrong?</label><br>
                    <select id="id_issue" name="issue" required>
                        <option value="" disabled selected>Select an issue</option>
                        <option>Installation failed</option>
                        <option>Smell of gas / suspected leak</option>
                        <option>Burner not lighting</option>
                        <option>Regulator/Valve issue</option>
                        <option>Other safety concern</option>
                    </select>
                </p>
                <p><label for="id_desc">Describe the problem</label><br>
                    <textarea id="id_desc" name="description" rows="4" placeholder="Provide details so we can assist faster‚Ä¶" required></textarea>
                </p>
                <p><label for="id_order">Order ID (optional)</label><br>
                    <input id="id_order" name="order_id" type="text" placeholder="e.g. GGO-2025-00123">
                </p>
                <p><label><input type="checkbox" name="callback" value="1"> I‚Äôd like a safety specialist to call me back ASAP</label></p>
            </fieldset>
            <p>
                <button type="submit" class="btn btn-primary">Submit emergency report</button>
                <a class="btn btn-outline" href="{% url 'index' %}">Go back home</a>
            </p>
        </form>
    </section>

    <section>
        <h2>Safety reminders</h2>
        <ul>
            <li>Keep cylinders upright, away from heat, and well‚Äëventilated.</li>
            <li>Always check for the seal and regulator fit; never force connections.</li>
            <li>Use soapy water to check for leaks; bubbles indicate a leak.</li>
            <li>Install a smoke/gas alarm if possible; keep a fire extinguisher nearby.</li>
            <li>Service hoses and regulators regularly; replace worn parts promptly.</li>
        </ul>
    </section>
</main>
{% endblock %}

{% block content_end %}
<footer>
    <p>Follow Us:</p>
    <nav aria-label="Support and social">
        <a href="#"><i class="fab fa-facebook"></i> Facebook</a>
        <a href="#"><i class="fab fa-instagram"></i> Instagram</a>
        <a href="#"><i class="fab fa-x-twitter"></i> X</a>
    </nav>
    <small>&copy; {{ now|default:2025 }} GasGo. All rights reserved.</small>
</footer>
{% endblock %}

{% block scripts %}
<script>
(function(){
  const log = document.getElementById('chatlog');
  const input = document.getElementById('chatinput');
  const send = document.getElementById('chatsend');

  function append(line, sender = 'bot') {
    const div = document.createElement('div');
    div.className = sender === 'bot' ? 'bot-msg' : 'user-msg';
    div[sender === 'bot' ? 'innerHTML' : 'textContent'] = line;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }

  function respond(text){
    const t = text.trim().toLowerCase();
    let reply = "I'm here to help. For life‚Äëthreatening situations, call <strong>999</strong> or <strong>112</strong> and our toll‚Äëfree <a href='tel:+254800720000' style='color:#D97706;'>0800 720 000</a>.";

    if (t.includes('fire')) {
      reply = "üî• <strong>Fire detected:</strong><br>Evacuate immediately.<br>Call <strong>999</strong> or <strong>112</strong>.<br>If trained and safe, use a Class B/C extinguisher.<br><em>Do not take risks.</em>";
    } else if (t.includes('smell') || t.includes('leak')) {
      reply = "üö® <strong>Gas leak suspected:</strong><br>Turn off the valve if safe.<br>Open windows, avoid switches/flames.<br>Evacuate.<br>Call <strong>999/112</strong> and <a href='tel:+254800720000' style='color:#D97706;'>0800 720 000</a>.";
    } else if (t.includes('install')) {
      reply = "üõ†Ô∏è <strong>Installation issue:</strong><br>Ensure regulator matches valve.<br>Check O‚Äëring and hose.<br>Do a soapy water leak test.<br>We can dispatch a technician ‚Äî please share your order ID and location.";
    } else if (t.includes('burner')) {
      reply = "üî• <strong>Burner not lighting:</strong><br>Confirm gas is on.<br>Ensure regulator is locked.<br>Verify hose connection.<br>Try a different ignition source.<br>Perform a leak check.";
    } else if (t.includes('regulator') || t.includes('valve')) {
      reply = "üîß <strong>Regulator/Valve issue:</strong><br>Check for proper fit.<br>Inspect for wear or damage.<br>Replace if loose or leaking.<br>Use soapy water to test.";
    } else {
      reply = "I can help with:<br>‚Ä¢ Gas leaks<br>‚Ä¢ Fire response<br>‚Ä¢ Burner or regulator issues<br>‚Ä¢ Installation problems<br><br>Type your concern or call <a href='tel:+254800720000' style='color:#D97706;'>0800 720 000</a>.";
    }

    append(reply, 'bot');
    input.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }

  function sendMsg(){
    const msg = input.value.trim();
    if (!msg) return;
    append(msg, 'user');
    input.value = '';
    setTimeout(() => respond(msg), 400);
  }

  if (send) send.addEventListener('click', sendMsg);
  if (input) input.addEventListener('keydown', function(e){ if (e.key === 'Enter'){ e.preventDefault(); sendMsg(); } });
})();
</script>

{% endblock %}
