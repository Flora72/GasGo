{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Profile | GasGo{% endblock %}
{% block page_title %}My Profile{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto pb-20 space-y-8">
    
    <section class="flex flex-col md:flex-row items-center gap-8 bg-white p-8 rounded-[3rem] border border-slate-100 shadow-sm">
        <div class="relative group">
            <div class="w-32 h-32 rounded-3xl bg-wells-navy flex items-center justify-center text-white text-4xl font-black overflow-hidden border-4 border-wells-green/20">
                {% if user.profile.profile_image %}
                    <img src="{{ user.profile.profile_image.url }}" class="w-full h-full object-cover">
                {% else %}
                    <img src="https://ui-avatars.com/api?name={{ user.username }} &background=001F3F&color=fff" alt="Default Profile">
                {% endif %}
            </div>
        </div>

        <div class="text-center md:text-left flex-1">
            <h1 class="text-3xl font-black text-wells-navy tracking-tighter">
                {{ user.get_full_name|default:user.username }}
            </h1>
            <p class="text-slate-500 font-medium">Member since {{ user.date_joined|date:"F Y" }}</p>
            <div class="mt-4 flex flex-wrap justify-center md:justify-start gap-3">
                <span class="px-4 py-1.5 bg-wells-green/10 text-wells-green rounded-full text-[10px] font-black uppercase tracking-widest">
                    <i class="fas fa-shield-check mr-1"></i> Verified Account
                </span>
                <span class="px-4 py-1.5 bg-wells-blue/10 text-wells-blue rounded-full text-[10px] font-black uppercase tracking-widest">
                    <i class="fas fa-gas-pump mr-1"></i> {{ orders.count }} Orders placed
                </span>
            </div>
        </div>
    </section>

    <div class="grid md:grid-cols-3 gap-8">
        
        <div class="md:col-span-2 space-y-6">
            <div class="bg-white p-8 rounded-[3rem] border border-slate-100 shadow-sm">
                <h3 class="text-xs font-black text-wells-navy uppercase tracking-[0.2em] mb-8">Personal Details</h3>
                
                <form method="POST" enctype="multipart/form-data" class="space-y-6">
                    {% csrf_token %}
                    <input type="file" name="profile_image" id="profile_image" class="hidden" accept="image/*">

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Username</label>
                            <input type="text" value="{{ user.username }}" disabled class="w-full bg-slate-50 border-none rounded-2xl px-6 py-4 text-sm text-slate-400 cursor-not-allowed outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Email Address</label>
                            <input type="email" value="{{ user.email }}" name="email" class="w-full bg-slate-50 border-none rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-wells-navy transition outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Phone Number</label>
                            <input type="text" name="phone_number" value="{{ user_profile.phone_number }}" placeholder="07XXXXXXXX" class="w-full bg-slate-50 border-none rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-wells-navy transition outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Full Name</label>
                            <input type="text" name="full_name" value="{{ user.get_full_name }}" class="w-full bg-slate-50 border-none rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-wells-navy transition outline-none">
                        </div>
                    </div>

                    <button type="submit" class="w-full md:w-auto bg-wells-navy text-white px-10 py-4 rounded-2xl font-black text-sm hover:bg-wells-green hover:shadow-xl transition-all">
                        Update Account Information
                    </button>
                </form>
            </div>
        </div>


            <div class="bg-wells-blue p-8 rounded-[3rem] text-white relative overflow-hidden">
                <h3 class="text-xs font-black uppercase tracking-[0.2em] mb-4 opacity-60">Latest Order</h3>
                {% if orders %}
                    {% with latest=orders.first %}
                        <p class="text-2xl font-black mb-1">#{{ latest.order_id }}</p>
                        <p class="text-xs font-bold opacity-80 uppercase">{{ latest.status }}</p>
                        <a href="{% url 'track_order' %}?order_id={{ latest.order_id }}" class="inline-block mt-6 text-[10px] font-black uppercase tracking-widest bg-white/20 px-4 py-2 rounded-lg hover:bg-white/30 transition">
                            Track Now
                        </a>
                    {% endwith %}
                {% else %}
                    <p class="text-sm font-bold opacity-80">No active orders found.</p>
                    <a href="{% url 'orders' %}" class="inline-block mt-6 text-[10px] font-black uppercase tracking-widest bg-white/20 px-4 py-2 rounded-lg hover:bg-white/30 transition">
                        Order Gas
                    </a>
                {% endif %}
                <i class="fas fa-history absolute -right-6 -bottom-6 text-8xl opacity-10"></i>
            </div>
        </div>
    </div>
</div>
{% endblock %}