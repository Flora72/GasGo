<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GasBot | GasGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="{% static 'images/logo.png' %}" type="image/png">
  <link rel="shortcut icon" href="{% static 'images/logo.png' %}" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
  <link rel="stylesheet" href="{% static 'css/bot.css' %}">
  <style>
    .typing .dots::after {
      content: '';
      display: inline-block;
      animation: dots 1s steps(3, end) infinite;
    }
    @keyframes dots {
      0% { content: ''; }
      33% { content: '.'; }
      66% { content: '..'; }
      100% { content: '...'; }
    }
    .bot-msg a {
       color: #D97706;
       text-decoration: underline;
     }

  </style>
</head>
<body>
<header class="header">
  <a href="{% url 'index' %}" class="logo">GasGo</a>
  <nav>
    <ul>
      <li><a href="{% url 'index' %}">Home</a></li>
      <li><a href="{% url 'about' %}">About Us</a></li>
      <li><a href="{% url 'contact' %}">Contact Us</a></li>
      <li><a href="{% url 'signup' %}">Sign Up</a></li>
      <li><a href="{% url 'login' %}">Login</a></li>
    </ul>
  </nav>
</header>

<main>
  <section>
    <h1>Meet GasBot</h1>
    <p>GasBot is a simple AI-style chatbot that can answer common questions about GasGo â€” ordering LPG, delivery, vendors, tracking, safety and more. Type a question below to get started.</p>
    <p>Need human help? Email <a href="mailto:gasgosupport@gmail.com">gasgosupport@gmail.com</a> or see <a href="{% url 'emergency' %}">Emergency</a>.</p>
  </section>

  <section>
    <h2>Chat</h2>
    <div class="chat-container">
      <div id="log" class="chat-log">
        <div class="bot-msg">Hi! I can help with:<br>
          â€“ Ordering and delivery<br>
          â€“ Vendors and payment options<br>
          â€“ Tracking your order<br>
          â€“ Safety and emergencies<br>
        </div>
      </div>
      <div class="chat-input">
        <input id="msg" type="text" placeholder="Type your questionâ€¦" />
        <button id="send" type="button">Send</button>
      </div>
      <p class="chat-note">Note: Demo only â€” no personal data is stored. For urgent safety issues, call 999/112 and our tollâ€‘free 0800 720 000.</p>
      <div class="chat-prompts">
        <button type="button" data-q="how do i order?">How do I order?</button>
        <button type="button" data-q="price 13kg">Price 13kg</button>
        <button type="button" data-q="track order">Track order</button>
        <button type="button" data-q="vendors near me">Vendors near me</button>
        <button type="button" data-q="i smell gas" data-emergency="1">I smell gas</button>
      </div>
    </div>

    <section class="gasbot-actions">
      <h2>Do more</h2>
      <ul>
        <li><a href="{% url 'orders' %}"><i class="fas fa-box"></i> Start an order</a></li>
        <li><a href="{% url 'vendors' %}"><i class="fas fa-store"></i> See vendors</a></li>
        <li><a href="{% url 'track_order' %}"><i class="fas fa-map-marker-alt"></i> Track an order</a></li>
        <li><a href="{% url 'emergency' %}"><i class="fas fa-exclamation-triangle"></i> Emergency help</a></li>
      </ul>
    </section>
  </section>
</main>

<footer>
  <p>Follow Us:</p>
  <nav aria-label="Support and social">
    <a href="#"><i class="fab fa-facebook"></i> Facebook</a>
    <a href="#"><i class="fab fa-instagram"></i> Instagram</a>
    <a href="#"><i class="fab fa-x-twitter"></i> X</a>
  </nav>
  <small>&copy; {{ now|default:2025 }} GasGo. All rights reserved.</small>
</footer>

<script>
(function(){
  const log = document.getElementById('log');
  const msg = document.getElementById('msg');
  const send = document.getElementById('send');

  function append(line, sender = 'bot') {
  const div = document.createElement('div');
  div.className = sender === 'bot' ? 'bot-msg' : 'user-msg';
  if (sender === 'bot') {
    div.innerHTML = line;
  } else {
    div.textContent = line;
  }
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}


function answer(text){
  const t = (text || '').trim().toLowerCase();
  function has(){ for (let i = 0; i < arguments.length; i++) { if (t.includes(arguments[i])) return true; } return false; }

  let reply = "Hmm, I didnâ€™t catch that. Try asking about:<br>â€¢ How to order<br>â€¢ LPG prices<br>â€¢ Tracking your order<br>â€¢ Safety tips<br>Or click a quick prompt below!";

  if (has('hi','hello','hey','gasbot')) {
    const hour = new Date().getHours();
    reply = hour < 12 ? "Good morning! â˜€ï¸ What can I help you with?" :
            hour < 18 ? "Good afternoon! ðŸ˜Š Need help with an order?" :
                        "Good evening! ðŸŒ™ Iâ€™m here if you need anything.";
  } else if (has('track','tracking','where','rider')) {
    reply = 'You can track your rider live on the map here: <a href="/track_order/" target="_blank" style="color:#D97706; text-decoration:underline;">Track Order</a>. Allow location for best accuracy.';
  } else if (has('how','order')) {
    reply = 'To order: go to <a href="/orders/" target="_blank" style="color:#D97706; text-decoration:underline;">Orders</a>, choose size (6kg/13kg/22.5kg/50kg), enter your address and contact, then pick a vendor and payment.';
  } else if (has('price','cost','how much','rates','charges','fees')) {
    reply = "Hereâ€™s our current LPG price list:<br>â€¢ 6kg Refill â€“ KSh 1,390<br>â€¢ 13kg Refill â€“ KSh 3,190<br>â€¢ 22.5kg Refill â€“ KSh 5,670<br>â€¢ 50kg Refill â€“ KSh 11,800<br><br>New cylinder + gas:<br>â€¢ 6kg â€“ KSh 3,190<br>â€¢ 13kg â€“ KSh 6,590<br>â€¢ 22.5kg â€“ KSh 13,170<br>â€¢ 50kg â€“ KSh 23,300<br><br>Prices include delivery and VAT. Final cost may vary slightly by vendor.";
  } else if (has('13kg','13 kg')) {
    reply = "13kg refill is KSh 3,190. A new 13kg cylinder with gas is KSh 6,590. Prices include delivery and VAT.";
  } else if (has('vendor','near me','partners')) {
    reply = 'After you fill your order, we show available vendors near you with ETA, ratings and prices. See <a href="/vendors/" target="_blank" style="color:#D97706; text-decoration:underline;">Vendors</a> for examples.';
  } else if (has('pay','payment','mpesa','cash','card')) {
    reply = "Payment options include Cash, Mâ€‘Pesa, or Card on delivery (depending on vendor). Choose on the Vendors confirmation step.";
  } else if (has('deliver','area','coverage','location')) {
    reply = "We serve major Nairobi neighborhoods via partner vendors. Enter your address on the order form to see nearby options and ETA.";
  } else if (has('time','eta','how long','minutes','hours')) {
    reply = "Typical ETA is 30â€“90 minutes depending on distance and traffic. Youâ€™ll see a live estimate after choosing a vendor.";
  } else if (has('safety','install','regulator','leak','smell','fire','burner')) {
    if (has('fire')) {
      reply = "If there is fire: evacuate immediately, call 999/112. If safe and trained, use a suitable extinguisher. Do not take risks.";
    } else if (has('smell','leak')) {
      reply = "If you smell gas: close the valve if safe, open windows, avoid switches/flames, evacuate, call 999/112 and 0800 720 000.";
    } else if (has('install','regulator')) {
      reply = "Installation tips: ensure regulator matches valve, check the Oâ€‘ring, secure the hose, and perform a soapy water leak test.";
    } else if (has('burner')) {
      reply = "Burner not lighting: confirm gas is on, regulator locked, hose ok, try another ignition, and perform a leak check.";
    } else {
      reply = "Safety first: keep cylinders upright/ventilated, check seals/regulator fit, and use soapy water for leak checks.";
    }
  } else if (has('contact','help','support','agent','human')) {
    reply = 'You can reach our team at <a href="mailto:gasgosupport@gmail.com" style="color:#D97706;">gasgosupport@gmail.com</a> or via the <a href="/emergency/" style="color:#D97706;">Emergency</a> page for urgent issues.';
  }

  append(reply, 'bot');
  msg.scrollIntoView({ behavior: 'smooth', block: 'center' });
}


  function sendMsg(){
    const q = msg.value.trim();
    if (!q) return;
    append('You: ' + q, 'user');

    msg.value = '';
    const typingDiv = document.createElement('div');
    typingDiv.className = 'bot-msg typing';
    typingDiv.innerHTML = 'GasBot is typing<span class="dots">...</span>';
    log.appendChild(typingDiv);
    log.scrollTop = log.scrollHeight;

    setTimeout(() => {
      const last = log.lastChild;
      if (last && last.classList.contains('typing')) log.removeChild(last);
      answer(q);
    }, 1000);
  }

  if (send) send.addEventListener('click', sendMsg);
  if (msg) msg.addEventListener('keydown', function(e){ if (e.key === 'Enter'){ e.preventDefault(); sendMsg(); }});

  Array.prototype.forEach.call(document.querySelectorAll('button[data-q]'), function(btn){
    btn.addEventListener('click', function(){
      if (btn.getAttribute('data-emergency') === '1') {
        window.location.href = "{% url 'emergency' %}";
        return;
      }
      msg.value = btn.getAttribute('data-q');
      sendMsg();
    });
  });
})();
</script>
</body>
</html>
